FROM eclipse-temurin:17-jre-jammy

# Run as UID 996 to match the cluster node's 'aeron' user.
# Shared volumes (cluster data, /dev/shm) are owned by UID 996.
RUN groupadd -g 996 aeron && useradd -u 996 -g 996 aeron
COPY agent/build/libs/agent-*.jar /app/agent.jar

USER 996
EXPOSE 7070

ENTRYPOINT ["java", \
  "--add-opens=java.base/sun.nio.ch=ALL-UNNAMED", \
  "--add-opens=java.base/java.lang.reflect=ALL-UNNAMED", \
  "--add-opens=java.base/jdk.internal.misc=ALL-UNNAMED", \
  "--add-exports=java.base/jdk.internal.ref=ALL-UNNAMED", \
  "-jar", "/app/agent.jar"]
