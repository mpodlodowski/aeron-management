apiVersion: v1
kind: Pod
metadata:
  name: backup
  namespace: aeron-demo
  labels:
    app: aeron-backup
spec:
  hostname: backup
  subdomain: aeron-cluster
  restartPolicy: Always
  containers:
    - name: backup-node
      image: aeron-cluster-demo:local
      imagePullPolicy: Never
      command: ["java",
        "--add-opens=java.base/sun.nio.ch=ALL-UNNAMED",
        "-Daeron.dir=/dev/shm/",
        "-Duser.dir=/home/aeron/aeron-cluster/",
        "-cp", "/app/app.jar:/app/aeron-all.jar",
        "BackupNode"]
      env:
        - name: CLUSTER_ADDRESSES
          value: "node-0.aeron-cluster,node-1.aeron-cluster,node-2.aeron-cluster"
      volumeMounts:
        - name: shm
          mountPath: /dev/shm
        - name: data
          mountPath: /home/aeron/aeron-cluster
    - name: agent
      image: aeron-management-agent:local
      imagePullPolicy: Never
      env:
        - name: MANAGEMENT_SERVER_HOST
          value: "management-server.aeron-demo.svc.cluster.local"
        - name: MANAGEMENT_SERVER_PORT
          value: "8081"
        - name: CLUSTER_DIR
          value: "/home/aeron/aeron-cluster/cluster"
        - name: AGENT_ID
          value: "agent-backup"
      volumeMounts:
        - name: shm
          mountPath: /dev/shm
        - name: data
          mountPath: /home/aeron/aeron-cluster
  volumes:
    - name: shm
      emptyDir:
        medium: Memory
        sizeLimit: 1Gi
    - name: data
      emptyDir: {}
