# Stage 1: Build
FROM eclipse-temurin:17-jdk-jammy AS build
WORKDIR /app
COPY . .
RUN ./gradlew :server:bootJar --no-daemon -x test
RUN cp server/build/libs/server-*.jar /server.jar

# Stage 2: Runtime
FROM eclipse-temurin:17-jre-jammy
COPY --from=build /server.jar /app/server.jar

EXPOSE 8080 8081

ENTRYPOINT ["java", "-jar", "/app/server.jar"]
